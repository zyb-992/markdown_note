# 初始Mysql

## 一、Mysql的C/S架构

- 客户端
- 服务端

## 二、Mysql安装

## 三、启动Mysql服务器程序

### 类unix启动服务器程序

1. `mysqld`

   1. 表示Mysql服务器程序 运行该exe文件可以启动Mysql服务器进程

2. `mysqld_safe`

   1. 间接调用mysqld并持续监控服务器的运行状态
   2. 当服务器进程出现错误时，可以帮助重启服务器程序，并将服务器程序的出错信息和诊断信息输出到错误日志

3. `mysql.server`

   1. 一个启动脚本

   2. 间接调用mysqld_safe

      ```shell
      # 启动服务器程序
      mysql.server start
      
      # 停止服务器程序
      mysql.server stop
      ```

### windows启动服务器程序

1. 手动启动

2. 以服务的方式启动

   ```shell
   # 
   "完整的可执行文件路径" --install [-manual] [服务名]
   
   # 
   net start MySQL
   net stop MySQL
   ```

3. 启动Mysq客户端程序

   ```shell
   mysql -h主机名 -u用户名 -p密码
   ```

   ![image-20221126205112018](D:\Program Files\电子书\go\md\图片\image-20221126205112018.png)

## 四、客户端与服务端连接的过程

### TCP/IP

1. mysql服务端默认端口号3306

2. 可使用`mysqld -P3307`指定端口号

   ```shell
   mysqld -h 127.0.0.1 -u root -P 3307 -p
   ```

### 命名管道和共享内存

- 使用共享内存进行通信的服务器和客户端必须位于同一台Windows主机中

![image-20221126205930966](D:\Program Files\电子书\go\md\图片\image-20221126205930966.png)

### UNIX域套接字

## 五、服务器处理客户端请求

1. 无论客户端和服务器采用哪种方式进行通信，最后实现的效果都是客户端进程向服务器进程发送一段文本（Mysql语句），服务器处理完后在向客户端进程返回处理结果
2. 处理过程
   1. **连接管理**
   2. **解析与优化**
   3. **存储引擎**

#### 连接管理

1. 每当有客户端连接到服务器时，服务器都会创建一个线程专门处理与这个客户端的交互
2. 客户端退出时会与服务器断开连接，服务器会将与该客户端交互的线程缓存起来，留给下次心的客户端连接，避免频繁创建销毁
3. 客户端程序发起连接时，需要携带主机信息、用户名、密码等信息，服务器会对客户端提供的信息进行认证
4. 若客户端与服务器不在同一台计算机上，还可以通过**传输层安全性TLS协议**对连接进行加密，保证数据传输的安全性

#### 解析与优化

1. 为了方便管理，Mysql服务器处理请求的过程简单划分为**server层**和**存储引擎层**，
   - 连接管理、查询缓存、语法解析、查询优化这些并不设计真实数据存取的功能划分为server层的功能，存取真实数据的功能划分为存储引擎层的功能
   - 在server层完成查询优化后，只需要按照生成的执行计划调用底层存储引擎提供的接口获取到数据后返回给客户端即可
   - **server层和存储引擎层交互时 一般是以记录为单位的 （server层现根据执行计划向存储引擎层取一条记录 判断是否符合WHERE条件 若符合则发送给客户端）在判断某条记录符合要求以后 先将其发送到一个缓冲区 待该缓冲区满了 才向客户端发送真正的记录 缓冲区大小由系统变量`net_buffer_length`控制**
2. ***查询缓存***
   1. Mysql服务器程序会将刚处理过的程序请求和结果缓存起来
   2. 下次有同样的请求过来可以直接从缓存中查找结果
   3. 若两个查询请求有任何字符上的不同（例如空格/注释/大小写）都会导致缓存不命中
   4. 如果查询请求中包含某些系统函数、用户自定义变量、系统表，则该请求不会被缓存（以系统函数为例，NOW函数每次调用的结果都不一样
   5. 若有其他增删改的操作，那么该表对应的所有查询缓存都会无效并从**查询缓存**中删除
   6. （Mysql8.0删除了查询缓存
3. ***语法解析***
   1. 查询缓存未命中，则进入正式的查询阶段
   2. 服务器程序先对这段文本进行分析，判断请求的语法是否正确
   3. 再从文本中将要查询大表以及各种查询条件都提取出来放到Mysql服务器内部使用的一些数据结构上
   4. 词法解析、语法分析、语义分析等等
4. ***查询优化***
   1. 对语句做一些优化，生成一个执行计划，表明应该使用哪些索引来执行查询，以及表之间的连接顺序是哪样
   2. 可以使用EXPLAIN语句来查看某个语句的执行计划
5. ***存储引擎***
   1. Mysql把数据的存储和提取操作都封装到了一个名为存储引擎的模块中
   2. 表是由一行行的记录组成的，这是一个逻辑上的概念
   3. 在物理上如何表示记录，怎么从表中读取数据以及怎么把数据写入具体的物理存储器上，是存储引擎负责的事情

![](D:\Program Files\电子书\go\md\图片\image-20221126205808976.png)