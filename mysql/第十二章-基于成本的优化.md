# 成本优化

> MySQL在执行一个查询时可以有不同的执行方案，优化器会选择其中成本最低，或者说代价最低的方案去真正执行查询。

## 什么是成本

- 一条查询语句在Mysql中的执行成本是由两个方面组成的
  - **IO成本**：数据从磁盘加载到内存中这个过程所损耗的时间
  - **CPU成本**：读取记录以及检测记录是否满足对应的搜索条件、对结果集进行排序等这些操作损耗的时间称为CPU成本
- IO成本：读取一个页面花费的成本默认是1.0
- CPU成本：读取以及检测一条记录是否符合搜索条件的成本默认是0.2



## 基于成本的优化步骤

1. 根据搜索条件，找出所有可能使用的索引
2. 计算全表扫描的代价
3. 计算使用不同索引执行查询的代价
4. 对比各种执行方案的代价，找出成本最低的那个方案

### 计算全表扫描的代价

1. 对InnoDB存储引擎，**全表扫描**即把聚簇索引中的记录都一次与给定的搜索条件进行比较，并把符合搜索条件的记录加入到结果集中

## 连接查询的成本

- 对于两表连接查询，查询插本由两部分构成
  - 单次查询驱动表的成本
  - 多次查询被驱动表的成本
- 驱动表的**扇出**：查询驱动表后得到的记录数
- 连接查询总成本=单次访问驱动表的成本+驱动表扇出值*单次访问被驱动表的成本
- 对于外连接：驱动表是固定的，所以只需要为驱动表和被驱动表选择成本最低的访问方法，即可得到最优的查询方案
- 对于内连接：驱动表和被驱动表的位置可以互换，因此要考虑不同表作为驱动表查询成本可能不同的问题，即需要考虑最优的表连接顺序