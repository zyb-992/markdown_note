# InnoDB数据页结构

> 页是InnoDB管理存储空间的基本单位，一个页的大小一般为16K
>
> 导入到内存中的数据按页的形式存在

## 数据页结构

![](D:\Program Files\电子书\go\md\图片\image-20221203193049380.png)

![](D:\Program Files\电子书\go\md\图片\image-20221203193115194.png)

## 记录在页中的存储

### 记录头信息的秘密

1. 存储的记录会按照指定的行格式存储到**User Records**部分中，一开始的页的User Record部分的空间是通过从**Free Space**抽取的

2. 记录中的头信息

   - `deleted_flag`：被删除的记录还存在于磁盘中 只是该位被标记为1，并加入到全局的垃圾链表中，之后可以被重用，即新插入的记录可以覆盖该内存空间的原本内容
   - `min_rec_flag`：B+树每层非叶子节点中的最小的目录项记录都会添加该标记
   - `n_owned`：
   - `heap_no`：记录在内存空间中按页存在的一条条亲密无间距排列的结构称为**堆**，在每申请一条新记录的存储空间时，该条记录比物理位置在它前面的那条记录的heap_no值大1
   - next_record：表示从当前记录的真实数据到下一条记录的真实数据的距离，因为存储引擎将数据导入到内存是按页导入的，所以这个距离指的是在页中相距的距离

   ![](D:\Program Files\电子书\go\md\图片\image-20221207175747395.png)

   ![](D:\Program Files\电子书\go\md\图片\image-20221207175808716.png)

3. 页中独有的两条记录

   - 设计者自动给页中添加了两条记录，并不是用户自己插入的，即时这两条记录没有主键，但设计者规定他们分别是页中的最小记录和最大记录

     - Infimum：页中的最小记录

     - Supremum：页中的最大记录

   - 这两条记录都是由固定的5字节的记录头信息和8字节的一个固定单词构成的

     ![](D:\Program Files\电子书\go\md\图片\image-20221207181124307.png)

### 页目录（存储槽

1. 将页中所有记录（不包括已经被删除的记录）划分为几个组

2. 每个组最主要的是组内最大的那条记录，被称为"带头大哥"，它记录头信息中的**n_owned**记录了它所在的组的记录数

3. 将每个组的"带头大哥"在页面中的地址偏移量（该记录的真实数据在页中的起始地址与页面的第0个字节之间的距离）单独提取出来，按顺序存储到靠近页尾部(File Trailer)的地方，即Page Directory

4. 页目录的这些地址偏移量称为**槽**，每个槽占用两个字节，**页目录就是由多个槽组成的**

   > 一页为16KB，寻址范围为0~16384字节，而槽由16位组成，可表示0~65535字节
   >
   > Infimum组内记录只能有1条，即本身
   >
   > Supremum组内记录可以有1~8条
   >
   > 普通组内记录数可以有4~8条

	5. 使用**二分法**在页目录中查找对应的记录

### 页面头部

### 文件头部

### 文件尾部