# 行记录格式

## COMPACT行格式

![](D:\Program Files\电子书\go\md\图片\image-20221203185714333.png)

### 字段含义

- 变长字段长度列表

  - 含义：记录该表中的一条记录的所有列为变长类型（如VARCHAR类型）的非NULL值数据的真实长度，同时**逆序存放**
  - 使用变长编码的字符集时（如utf8，0-3字节），即时某列类型为定长类型，该列占用的字节数也会加入该列表中

- NULL值列表

  - 含义：COMPACT行格式把一条记录中值为NULL的列统一管理起来，存储到NULL值列表中
  - 处理过程
    - 首先统计表中允许存储NULL值的列
    - 将每个允许存储NULL的列对应一个二进制位，二进制位按照列的顺序**逆序**排列
      - 二进制位值为1时，代表该列的值为NULL
      - 二进制位值为0时，代表该列的值不为NULL
      - 且NULL值列表必须使用整数个字节的位来表示，不足往高位补0

- 记录头信息

  - 含义：描述记录的一些属性，固定5字节，即40个二进制位

  ![](D:\Program Files\电子书\go\md\图片\image-20221203191504588.png)

  ![](D:\Program Files\电子书\go\md\图片\image-20221203191414860.png)

- 记录的真实数据

  - 除了记录一条记录的真实数据外，还为每条记录默认添加了一些列（隐藏列）

    ![](D:\Program Files\电子书\go\md\图片\image-20221203191750996.png)

## 不同类型的字段存储格式

### CHAR(M)列的存储格式

1. 不变长字段：该列给予的空间除真实数据外，其余字节使用空格补充

2. CHAR(M)类型的列至少占用M个字节，而VARCHAR(M)没有该要求，视字符集而定，例如utf8的字符集，varchar字段的空间为10-30字节

   

