# 计算机系统概述 

# 1. 基本构成

1. 主要组成部分
   1. 处理器：单独一个处理器时通常指**中央处理器**(CPU) 现在许多芯片上嵌入了多个处理器的核 也称多核处理器
      1. **存储器地址寄存器：MAR**
      2. **存储器缓冲寄存器：MBR**
      3. **输入/输出地址寄存器：IO AR**
      4. **输入/输出缓冲寄存器：IO BR**

![image-20220807203429861](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807203429861.png)

![image-20220807202904885](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807202904885.png)

2. 内存：主存储器RAM 存储运行的程序代码和数据等

3. 输入输出模块：**IO模块** 在计算机和外部IO设备之间移动数据

4. 系统总线：在处理器、内存和输入/输出模块间提供通信的设施



# 2. 指令执行

1. 处理器执行程序是由一组保存在主存储器中的指令组成的
2. 最简单的指令处理：**取指+执行指令** (若有中断在执行指令之后还需要添加中断判断模块 执行某些固定的指令判断当前是否有中断发生)

![image-20220807203609806](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807203609806.png)

# 3. 中断

1. **计算机都提供允许其他模块(IO、存储器)中断处理器正常处理过程的机制**
2. 中断分类：

![image-20220807203906453](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807203906453.png)

3. **中断是用于提高处理器效率的一种手段**
4. 对于无中断来说 程序执行一段代码后进入了系统调用WRITE  此时进入IO程序(一个系统工具程序) 由它执行 真正的IO操作(先为实际的IO操作做准备 然后进行实际的IO命令 以及完成最后的操作) 这时完成IO操作回花费较长的时间 进行IO的源程序需要挂起直到IO操作完成 因此用户程序会在IO处停留较长一段时间 
5. 对于有中断来说 当执行到了系统调用WRITE时 **此时对于处理器来说 IO程序和源程序是并发执行的 即源程序继续执行指令 不等待IO完成 等到操作系统内核得知IO完成时 触发中断 此时源程序暂停运行 CPU执行中断处理程序 执行完毕后 继续运行源程序**
6. 因此 **无论是中断:短IO等待 还是长IO等待** 都比无中断的效率高许多

![image-20220807204802083](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807204802083.png)

7. 加入中断后 CPU的**执行流程**

![image-20220807204903124](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807204903124.png)

8. 中断处理

![image-20220807204931605](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807204931605.png)

# 4. 存储器的层次结构

1. **局部性原理**：
2. 高速缓存
   1. 原理：高速缓存包含一部分内存数据的**副本** 当处理器试图读取存储器中的一个字节或字时 要进行一次检查以确定该字是否在告诉缓冲中(通过该字在内存中的地址地址判断) 如果在 则该字从高速缓存传递给处理器 否则 有固定数目的字节组成的一块内存数据读入高速缓存 然后该字从高速缓存传递给处理器
   2. 根据访问局部性原理 ： 当一块数据呗屈辱高速缓存以满足一次存储器访问时 很可能紧接着的多次访问的数据是该块中的其他字节

![image-20220807205043488](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807205043488.png)

3. 内存由2的n次方个可寻址的字组成 每个字有唯一的n位地址 有n条地址线就有n位地址 
4. 内存可由一些固定大小的块组成 每块包含K个字 即有**M的2的n次方/K个块**
5. 高速缓存中有C个槽 C<<M 每个槽中也有K个字 内存中块的某些子集驻留在高速缓存的槽中如果读存储器中某一块的某一个字 而该块又不在槽中 则将这个块转移到一个槽中

![image-20220807205054280](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807205054280.png)



![image-20220807205103490](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807205103490.png)

6. 直接内存存取

   1. 执行iO操作的技术

      1. 可编程IO: 不中断处理器 处理器需等待很久直到IO模块完成数据收发

      2. 中断驱动IO: 由处理器给IO模块发送IO命令 然后处理器继续其他工作 等到IO模块执行后 进入中断 处理器与IO模块交换数据

      3. 直接内存存取DMA: 在处理器读写一块数据时 给DMA模块产生一条命令 发送信息

         ![image-20220807215439443](C:\Users\zyb\AppData\Roaming\Typora\typora-user-images\image-20220807215439443.png)

         **之后处理器继续其他工作 处理器把这个操作给DMA模块处理 DMA模块直接与存储器交互 传送整个数据块 每次传送一个字 传送完成后 DMA模块向处理器发送一个中断信号**